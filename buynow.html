<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Pay Now – AIRDROP USDT KE</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Firebase Config -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyD2Dqz6jg8YACBvg_G_7yIR6c8sSH39BsQ",
  authDomain: "cypx-onlinecrypto.firebaseapp.com",
  databaseURL: "https://cypx-onlinecrypto-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cypx-onlinecrypto",
  storageBucket: "cypx-onlinecrypto.firebasestorage.app",
  messagingSenderId: "857500807275",
  appId: "1:857500807275:web:0e04242866ff30bec3812e",
  measurementId: "G-7PXLNKJLXV"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
</script>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, #001f3f, #001a33);
  color: #fff;
  padding-bottom: 60px;
}
header {
  background: rgba(0,0,0,0.5);
  padding: 14px 16px;
  font-size: 1.3rem;
  font-weight: 600;
  text-align: center;
  backdrop-filter: blur(8px);
}
.card {
  margin: 16px;
  padding: 16px;
  background: rgba(255,255,255,0.08);
  border-radius: 12px;
  box-shadow: 0 0 12px rgba(0,100,255,0.3);
  backdrop-filter: blur(6px);
}
.card h3 {
  margin: 0 0 8px;
  font-size: 1.1rem;
  font-weight: 600;
  color: #00c3ff;
}
.card p {
  margin: 0 0 6px;
  color: #f2f2f2;
  font-size: 0.9rem;
  line-height: 1.4;
}
.input-card {
  margin: 16px;
  padding: 16px;
  background: rgba(255,255,255,0.08);
  border-radius: 12px;
}
.input-card label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
}
.input-card input {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  margin-bottom: 12px;
  text-transform: uppercase;
}
.btn {
  display: block;
  width: 100%;
  padding: 12px;
  background: #0047ab;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 8px rgba(0,100,255,0.5);
}
.btn:hover {
  background: #005eff;
  transform: scale(1.03);
}
nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  padding: 6px 0;
}
nav a {
  color: #fff;
  text-decoration: none;
  text-align: center;
  font-size: 0.8rem;
}
nav i {
  font-size: 18px;
}
.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  background: #0047ab;
  color: #fff;
  padding: 14px 18px;
  border-radius: 10px;
  font-weight: 600;
  box-shadow: 0 0 12px rgba(0,100,255,0.5);
  z-index: 9999;
  opacity: 0;
  animation: fadeIn 0.4s ease-in-out forwards;
}
.popup.red {
  background: #cc0000;
  box-shadow: 0 0 12px rgba(255,0,0,0.5);
}
@keyframes fadeIn {
  from {opacity: 0; transform: translate(-50%, -60%);}
  to {opacity: 1; transform: translate(-50%, -50%);}
}
</style>
</head>
<body>

<header>Send Money to AIRDROP USDT KE</header>

<div class="card">
  <h3><i class="fas fa-mobile-alt"></i> Safaricom M-PESA</h3>
  <p><strong>Follow these steps:</strong></p>
  <p>1️⃣ Dial <span style="color:#00c3ff;">*334#</span></p>
  <p>2️⃣ Select <strong>"Send Money"</strong></p>
  <p>3️⃣ Enter recipient number: <strong style="color:#00c3ff;">0713627590</strong></p>
  <p>4️⃣ Name: <strong style="color:#00c3ff;">SISCO CHEPNGENO</strong></p>
  <p>5️⃣ Enter the correct amount in <strong>KSH</strong> and confirm payment.</p>
  <p>After sending, enter the <strong>M-PESA Transaction ID</strong> below to confirm your payment.</p>
</div>

<div class="input-card">
  <label for="mpesaCode">Enter M-PESA Transaction ID (e.g. TJU8R8QTBS)</label>
  <input type="text" id="mpesaCode" placeholder="e.g. TJU8R8QTBS" maxlength="10">
  <button class="btn" id="submit-deposit">Submit Details</button>
</div>

<div class="card">
  <h3><i class="fas fa-info-circle"></i> Important Information</h3>
  <p>✅ Make sure you enter the correct M-PESA Transaction ID.</p>
  <p>✅ The code must be exactly 10 characters long, containing both letters and numbers.</p>
  <p>✅ Our team will verify your payment shortly and update your balance.</p>
</div>

<nav>
  <a href="dashboard.html"><i class="fas fa-home"></i><br>Home</a>
  <a href="task.html"><i class="fas fa-tasks"></i><br>Tasks</a>
  <a href="team.html"><i class="fas fa-users"></i><br>Team</a>
  <a href="vip.html"><i class="fas fa-crown"></i><br>VIP</a>
  <a href="profile.html"><i class="fas fa-user"></i><br>Profile</a>
</nav>

<script>
function showPopup(msg, red = false) {
  const p = document.createElement('div');
  p.className = 'popup' + (red ? ' red' : '');
  p.textContent = msg;
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 3000);
}

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location = 'signin.html';
    return;
  }

  const uid = user.uid;

  document.getElementById('submit-deposit').addEventListener('click', () => {
    const codeInput = document.getElementById('mpesaCode');
    const code = codeInput.value.trim().toUpperCase();

    if (!code) {
      showPopup('Please enter M-PESA transaction code', true);
      return;
    }
    if (!/^[A-Z0-9]{10}$/.test(code) || !/[A-Z]/.test(code) || !/[0-9]/.test(code)) {
      showPopup('Invalid M-PESA transaction code', true);
      return;
    }

    const btn = document.getElementById('submit-deposit');
    btn.disabled = true;
    btn.textContent = 'Submitting...';

    const depositData = {
      mpesaCode: code,
      status: 'pending',
      created: Date.now()
    };

    // ✅ Write to the same secure node as deposit.html
    db.ref('users/' + uid + '/deposits').push(depositData)
      .then(() => {
        showPopup('✅ Your M-PESA code has been submitted successfully');
        codeInput.value = '';
        btn.disabled = false;
        btn.textContent = 'Submit Details';
      })
      .catch(err => {
        console.error(err);
        showPopup('An error occurred, please try again', true);
        btn.disabled = false;
        btn.textContent = 'Submit Details';
      });
  });
});
</script>

</body>
</html>
